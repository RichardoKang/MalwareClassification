#   训练集分割 2024-03-14 已完成
#   auther: KangWei
#   1. 从train_label.csv中随机选取40%的样本，存入test_label.csv
#   2. 将test_label中的文件移动到test文件夹
#   3. 从train_label.csv中删除test_label中的样本
#   4. 保存新的train_label.csv
#
#
import os
import random
import shutil
import pandas as pd


def divided_train_set():
    # 读取Label
    label = pd.read_csv('data/raw_data/train_label.csv')

    # 读取文件夹下的所有文件名
    files = os.listdir('data/raw_data/train/pe')

    # 选取Label中的40%样本，存入test_label.csv
    test_label = label.sample(frac=0.4, random_state=1)
    test_label.to_csv('data/raw_data/test_label.csv', index=False)

    # 将test_label中的文件移动到test文件夹
    for filename in test_label['filename'].tolist():
        shutil.move(f'data/raw_data/train/pe/{filename}', f'data/raw_data/test/pe/{filename}')
        shutil.move(f'data/raw_data/train/asm/{filename}.asm', f'data/raw_data/test/asm/{filename}.asm')


def label_deduplication():
    # 读取Label
    train_label = pd.read_csv('data/raw_data/train_label.csv')
    test_label = pd.read_csv('data/raw_data/test_label.csv')

    # 把test_label中的文件名从train_label中删除
    train_label = train_label[~train_label['filename'].isin(test_label['filename'])]
    train_label.to_csv('data/raw_data/train_label.csv', index=False)


if __name__ == '__main__':
    # divided_train_set()
    # label_deduplication()
    print("训练集分割完成")
