import pandas as pd
from sklearn.metrics import log_loss


# 采用多分类对数损失函数对结果进行评价,文件来源为：data/prediction_result/result.csv

def evaluate():

    # 读取结果文件
    result = pd.read_csv('../data/prediction_result/result.csv')

    # 读取测试集的标签
    test_label = pd.read_csv('../data/raw_data/test/test_label.csv')

    # 读取测试集的文件名
    test_filename = pd.read_csv('../data/intermediate/test_filename.txt', header=None)

    # 将文件名和标签合并, 通过文件名将标签和文件名对应,左边是文件名，右边是标签
    test_label = pd.merge(test_label, test_filename, left_on='filename', right_on=0, how='right')

    # 将标签转化为one-hot形式
    test_label = pd.get_dummies(test_label['family'])

    # 将结果文件和标签文件合并
    result = pd.merge(result, test_label, left_on='filename', right_on='family', how='right')

    # 计算对数损失
    logloss = log_loss(result['family_x'], result['family_y'])

    # 输出结果
    print('logloss: ', logloss)


if __name__ == '__main__':
    evaluate()
